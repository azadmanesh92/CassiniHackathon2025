<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeraVisit Demo</title>
    <!-- Using Tailwind CSS for rapid UI development -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Using Phosphor Icons for a modern feel -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        /* Using the Inter font, as is common for modern apps */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Custom animation for the stamp */
        @keyframes stamp-appear {
            0% {
                opacity: 0;
                transform: scale(1.5) rotate(15deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }
        .stamp-animation {
            animation: stamp-appear 0.5s ease-out;
        }

        /* Custom animation for scanning */
        @keyframes scanner-line {
            0% { top: 0; }
            100% { top: 100%; }
        }
        .scanner-line {
            position: absolute;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, transparent, theme('colors.blue.300'), transparent);
            box-shadow: 0 0 15px theme('colors.blue.300');
            animation: scanner-line 2s ease-in-out infinite;
        }

        /* Styling for the simulated phone */
        .phone-container {
            width: 100%;
            max-width: 400px;
            height: 800px;
            background: #1e1e2e; /* Dark theme */
            border: 12px solid #111;
            border-radius: 40px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.4);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        .screen {
            flex-grow: 1;
            overflow-y: auto;
            background: #f4f5f7; /* Light mode screen */
            display: flex;
            flex-direction: column;
            /* Add padding to bottom to not be hidden by tab bar */
            padding-bottom: 80px; 
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: #f4f5f7;
            /* We'll make it sticky at the top of the .screen */
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 1px solid #e5e7eb;
        }
        
        /* Styling for the new tab bar */
        .tab-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: white;
            border-top: 1px solid #e5e7eb;
            border-bottom-left-radius: 28px;
            border-bottom-right-radius: 28px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 20;
        }
        .tab-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.75rem;
            color: #6b7280; /* text-gray-500 */
            background: none;
            border: none;
            cursor: pointer;
        }
        .tab-button.active {
            color: #2563eb; /* text-blue-600 */
        }
        .tab-button i {
            font-size: 1.75rem; /* text-3xl */
            margin-bottom: 2px;
        }

        /* Styling for the new Floating Action Button (FAB) */
        .fab {
            position: absolute;
            bottom: 90px; /* Above the tab bar */
            right: 20px;
            z-index: 15;
            width: 60px;
            height: 60px;
            border-radius: 9999px;
            background-color: #2563eb; /* bg-blue-600 */
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: all 0.2s ease-out;
        }
        .fab:hover {
            background-color: #1d4ed8; /* bg-blue-700 */
        }
        .fab i {
            font-size: 1.75rem;
        }
    </style>
</head>
<body class="bg-gray-800 flex items-center justify-center min-h-screen p-4">

    <!-- This is the container simulating the smartphone -->
    <div class="phone-container">
        
        <!-- Simulated Status Bar -->
        <div class="status-bar">
            <span class="text-sm font-semibold">9:34 AM</span>
            <div class="flex items-center space-x-1">
                <i class="ph ph-wifi-high text-gray-800"></i>
                <!-- Added "Galileo" icon to status bar -->
                <i class="ph ph-satellite text-blue-600 text-xs font-bold"></i>
                <i class="ph ph-battery-full text-gray-800"></i>
            </div>
        </div>

        <!-- App Screen -->
        <div class="screen" id="app-screen">
            
            <!-- VIEW 1: Passport View (Main) -->
            <div id="passport-view" class="flex flex-col h-full">
                <!-- Header -->
                <header class="p-4">
                    <div class="flex justify-between items-center">
                        <h1 class="text-3xl font-bold text-gray-900">VeraVisit</h1>
                        <!-- Updated Header with Points -->
                        <div class="flex items-center space-x-3">
                            <div class="flex items-center space-x-1 p-2 bg-white rounded-full shadow-sm border">
                                <i class="ph-bold ph-coin text-yellow-500 text-xl"></i>
                                <span id="user-points" class="font-semibold text-gray-800">1250</span>
                            </div>
                            <div class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-semibold">A</div>
                        </div>
                    </div>
                    <p class="text-gray-500">Your verifiable Geo-Passport</p>
                </header>

                <!-- Passport Stamps Section -->
                <main class="flex-grow p-4 overflow-y-auto">
                    <h2 class="text-lg font-semibold text-gray-800 mb-3">My Stamps</h2>
                    <div id="stamp-grid" class="grid grid-cols-2 gap-4">
                        
                        <!-- Sample Stamp 1: Clickable, with proof -->
                        <div id="ivan_vazov_theatre" class="stamp-clickable aspect-square bg-white border border-gray-200 rounded-lg p-3 flex flex-col items-center justify-center text-center shadow-sm cursor-pointer hover:shadow-md transition-shadow"
                             data-title='"Ivan Vazov" National Theatre'
                             data-img="https://placehold.co/400x300/e2e8f0/64748b?text=My+Photo+Here"
                             data-proof-text="Absolutely stunning architecture! A must-see in Sofia. The atmosphere at night is magical. I'm so glad I came here, and it's amazing to have a verified stamp for it!">
                            <i class="ph-fill ph-check-circle text-green-500 text-2xl absolute top-2 right-2"></i>
                            <i class="ph-bold ph-theater text-5xl text-red-600"></i>
                            <h3 class="font-semibold mt-2">"Ivan Vazov" National Theatre</h3>
                            <p class="text-xs text-gray-500">Sofia, Bulgaria</p>
                            <p class="text-xs text-gray-500">Verified: 24 Oct 2025</p>
                        </div>

                        <!-- Sample Stamp 2: Clickable, but no proof yet -->
                        <div id="eagles_bridge" class="stamp-clickable aspect-square bg-white border border-gray-200 rounded-lg p-3 flex flex-col items-center justify-center text-center shadow-sm cursor-pointer hover:shadow-md transition-shadow"
                             data-title="Eagle's Bridge"
                             data-img=""
                             data-proof-text="">
                            <i class="ph-fill ph-check-circle text-green-500 text-2xl absolute top-2 right-2"></i>
                            <i class="ph-bold ph-bridge text-5xl text-purple-600"></i>
                            <h3 class="font-semibold mt-2">Eagle's Bridge</h3>
                            <p class="text-xs text-gray-500">Sofia, Bulgaria</p>
                            <p class="text-xs text-gray-500">Verified: 26 Oct 2025</p>
                        </div>
                        
                        <!-- This is a placeholder for the stamp we will earn -->
                        <!-- <div id="nevsky_cathedral" class="hidden ..."></div> -->

                    </div>
                </main>
                <!-- Footer (now empty, replaced by FAB and Tab Bar) -->
                <footer class="p-6">
                </footer>
            </div>

            <!-- VIEW 2: Map View (New) -->
            <div id="map-view" class="hidden flex-col h-full">
                <header class="p-4">
                    <h1 class="text-3xl font-bold text-gray-900">Locations</h1>
                    <p class="text-gray-500">Find your next VeraVisit Beacon</p>
                </header>
                <main class="flex-grow bg-gray-200">
                    <!-- 
                      This is a 100% working, API-key-free OpenStreetMap embed.
                      It's centered on Sofia and has markers for our 3 landmarks:
                      - Nevsky Cathedral (42.6958, 23.3328)
                      - Ivan Vazov Theatre (42.6946, 23.3217)
                      - Eagle's Bridge (42.6896, 23.3343)
                    -->
                    <iframe 
                        width="100%" 
                        height="100%" 
                        frameborder="0" 
                        scrolling="no" 
                        marginheight="0" 
                        marginwidth="0" 
                        src="https://www.openstreetmap.org/export/embed.html?bbox=23.3150,42.6880,23.3400,42.6990&amp;layer=mapnik&amp;marker=42.6958,23.3328&amp;marker=42.6946,23.3217&amp;marker=42.6896,23.3343" 
                        style="border: 1px solid black">
                    </iframe>
                </main>
            </div>

            <!-- VIEW 3: Friends View (New) -->
            <div id="friends-view" class="hidden flex-col h-full">
                <header class="p-4">
                    <h1 class="text-3xl font-bold text-gray-900">Friends</h1>
                    <p class="text-gray-500">See your friends' verified passports</p>
                </header>
                <main class="flex-grow p-4 space-y-3">
                    <!-- This is a "peaceful" friends list. No chat, no comments. -->
                    <div class="bg-white p-4 rounded-lg shadow-sm border flex justify-between items-center">
                        <div class="flex items-center">
                            <div class="w-12 h-12 rounded-full bg-red-500 text-white flex items-center justify-center font-semibold text-xl mr-3">G</div>
                            <div>
                                <h3 class="font-semibold text-lg">Georgi Dimitrov</h3>
                                <p class="text-sm text-gray-500">Collected 14 Stamps</p>
                            </div>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600">
                            <i class="ph ph-user-circle text-3xl"></i>
                        </button>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border flex justify-between items-center">
                        <div class="flex items-center">
                            <div class="w-12 h-12 rounded-full bg-purple-500 text-white flex items-center justify-center font-semibold text-xl mr-3">A</div>
                            <div>
                                <h3 class="font-semibold text-lg">Anna Petrova</h3>
                                <p class="text-sm text-gray-500">Collected 9 Stamps</p>
                            </div>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600">
                            <i class="ph ph-user-circle text-3xl"></i>
                        </button>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border flex justify-between items-center">
                        <div class="flex items-center">
                            <div class="w-12 h-12 rounded-full bg-yellow-500 text-white flex items-center justify-center font-semibold text-xl mr-3">V</div>
                            <div>
                                <h3 class="font-semibold text-lg">Viktor Krum</h3>
                                <p class="text-sm text-gray-500">Collected 2 Stamps</p>
                            </div>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600">
                            <i class="ph ph-user-circle text-3xl"></i>
                        </button>
                    </div>
                </main>
            </div>

            <!-- VIEW 4: Settings View (New) -->
            <div id="settings-view" class="hidden flex-col h-full">
                <header class="p-4">
                    <h1 class="text-3xl font-bold text-gray-900">Settings</h1>
                    <p class="text-gray-500">Manage your account and preferences</p>
                </header>
                <main class="flex-grow p-4 space-y-4">
                    <!-- Profile Section -->
                    <div class="bg-white p-4 rounded-lg shadow-sm border flex justify-between items-center cursor-pointer">
                        <span class="font-semibold text-gray-700">Profile</span>
                        <i class="ph ph-caret-right text-gray-400"></i>
                    </div>

                    <!-- Points & Shop Section -->
                    <div class="bg-white p-4 rounded-lg shadow-sm border flex justify-between items-center cursor-pointer">
                        <span class="font-semibold text-gray-700">Points Shop</span>
                        <div class="flex items-center space-x-2 text-blue-600">
                            <span class="font-semibold">Spend Points</span>
                            <i class="ph ph-caret-right"></i>
                        </div>
                    </div>
                    
                    <!-- Safety Feature Section -->
                    <div class="bg-white p-4 rounded-lg shadow-sm border">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="font-semibold text-gray-700">24-Hour Proof Delay</h3>
                                <p class="text-sm text-gray-500">Post your public proofs 24 hours after visiting.</p>
                            </div>
                            <!-- Simple Tailwind Toggle Switch -->
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" value="" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-2 peer-focus:ring-blue-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Other Settings -->
                    <div class="bg-white p-4 rounded-lg shadow-sm border flex justify-between items-center cursor-pointer">
                        <span class="font-semibold text-gray-700">Privacy & Security</span>
                        <i class="ph ph-caret-right text-gray-400"></i>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border flex justify-between items-center cursor-pointer">
                        <span class="font-semibold text-red-500">Log Out</span>
                    </div>
                </main>
            </div>

            <!-- VIEW 5: Scanning View (Was VIEW 3) -->
            <div id="scanning-view" class="hidden flex-col h-full bg-gray-900 text-white p-6 justify-between">
                <div>
                    <h2 class="text-2xl font-semibold text-center mb-6">Scanning for VeraVisit Beacon...</h2>
                    <div class="relative w-64 h-64 mx-auto rounded-lg overflow-hidden border-2 border-blue-400 bg-gray-800">
                        <!-- This simulates the landmark (Nevsky Cathedral) -->
                        <i class="ph-bold ph-church text-9xl text-gray-600 absolute inset-0 flex items-center justify-center"></i>
                        <div class="scanner-line"></div>
                    </div>
                </div>
                
                <div class="text-center">
                    <div id="verification-steps">
                        <!-- JS will inject status messages here -->
                    </div>
                </div>

                <button id="cancel-button" class="w-full bg-gray-700 text-white rounded-lg h-12 flex items-center justify-center font-semibold">
                    Cancel
                </button>
            </div>

        </div> <!-- /screen -->

        <!-- Floating Action Button (FAB) for Scanning -->
        <button id="scan-button" class="fab">
            <i class="ph-bold ph-scan"></i>
        </button>

        <!-- Tab Bar -->
        <footer class="tab-bar">
            <button id="passport-tab" class="tab-button active">
                <i class="ph-bold ph-list"></i>
                Passport
            </button>
            <button id="map-tab" class="tab-button">
                <i class="ph-bold ph-map-trifold"></i>
                Map
            </button>
            <button id="friends-tab" class="tab-button">
                <i class="ph-bold ph-users"></i>
                Friends
            </button>
            <button id="settings-tab" class="tab-button">
                <i class="ph-bold ph-gear"></i>
                Settings
            </button>
        </footer>

    </div> <!-- /phone-container -->
    
    <!-- MODAL for "Proof" (Hidden by default) -->
    <div id="proof-modal" class="hidden absolute inset-0 bg-black/60 flex items-center justify-center p-4 z-30">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm overflow-hidden">
            <header class="p-4 border-b border-gray-200 flex justify-between items-center">
                <h3 id="modal-title" class="text-lg font-semibold">Landmark Name</h3>
                <button id="modal-close-btn" class="text-gray-400 hover:text-gray-600">
                    <i class="ph ph-x text-2xl"></i>
                </button>
            </header>
            <main class="p-4">
                <img id="modal-img" src="" alt="User Proof Photo" class="w-full h-48 object-cover rounded-md bg-gray-100 mb-4">
                <div id="modal-caption-wrapper">
                    <p class="text-xs text-gray-500 uppercase font-semibold mb-1">My 50-Word Proof</p>
                    <p id="modal-caption" class="text-gray-700 text-sm"></p>
                </div>
                <div id="modal-add-proof" class="hidden text-center">
                    <p class="text-gray-500 mb-3">You haven't added your proof yet.</p>
                    <button class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg text-sm">
                        Add Photo & Note
                    </button>
                </div>
            </main>
        </div>
    </div>


    <script>
        // === Get all the DOM elements we need ===
        const passportView = document.getElementById('passport-view');
        const mapView = document.getElementById('map-view');
        const friendsView = document.getElementById('friends-view');
        const settingsView = document.getElementById('settings-view');
        const scanningView = document.getElementById('scanning-view');
        
        const passportTab = document.getElementById('passport-tab');
        const mapTab = document.getElementById('map-tab');
        const friendsTab = document.getElementById('friends-tab');
        const settingsTab = document.getElementById('settings-tab');
        const scanButton = document.getElementById('scan-button');
        const cancelButton = document.getElementById('cancel-button');
        
        const stampGrid = document.getElementById('stamp-grid');
        const verificationSteps = document.getElementById('verification-steps');
        const userPointsEl = document.getElementById('user-points');

        const proofModal = document.getElementById('proof-modal');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalTitle = document.getElementById('modal-title');
        const modalImg = document.getElementById('modal-img');
        const modalCaption = document.getElementById('modal-caption');
        const modalCaptionWrapper = document.getElementById('modal-caption-wrapper');
        const modalAddProof = document.getElementById('modal-add-proof');

        // This is the stamp we will add
        const newStamp = {
            id: 'nevsky_cathedral',
            name: 'Nevsky Cathedral',
            icon: 'ph-church',
            color: 'text-yellow-600',
            date: '27 Oct 2025',
            city: 'Sofia',
            country: 'Bulgaria',
            img: '',
            proof_text: ''
        };

        // --- Event Listeners ---
        
        scanButton.addEventListener('click', startScan);
        cancelButton.addEventListener('click', cancelScan);
        passportTab.addEventListener('click', showPassportView);
        mapTab.addEventListener('click', showMapView);
        friendsTab.addEventListener('click', showFriendsView);
        settingsTab.addEventListener('click', showSettingsView);
        
        // --- Stamp "Proof" Modal Listeners ---
        stampGrid.addEventListener('click', (e) => {
            // We use .closest() to make sure we get the stamp,
            // even if the user clicks the icon or text inside it.
            const stamp = e.target.closest('.stamp-clickable');
            if (stamp) {
                openProofModal(stamp);
            }
        });
        modalCloseBtn.addEventListener('click', () => {
            proofModal.classList.add('hidden');
        });


        // === Tab Navigation Functions ===

        function showPassportView() {
            passportView.classList.remove('hidden');
            passportView.classList.add('flex');
            mapView.classList.add('hidden');
            mapView.classList.remove('flex');
            friendsView.classList.add('hidden');
            friendsView.classList.remove('flex');
            settingsView.classList.add('hidden');
            settingsView.classList.remove('flex');
            
            passportTab.classList.add('active');
            mapTab.classList.remove('active');
            friendsTab.classList.remove('active');
            settingsTab.classList.remove('active');
            scanButton.classList.remove('hidden');
        }

        function showMapView() {
            passportView.classList.add('hidden');
            passportView.classList.remove('flex');
            mapView.classList.remove('hidden');
            mapView.classList.add('flex');
            friendsView.classList.add('hidden');
            friendsView.classList.remove('flex');
            settingsView.classList.add('hidden');
            settingsView.classList.remove('flex');

            passportTab.classList.remove('active');
            mapTab.classList.add('active');
            friendsTab.classList.remove('active');
            settingsTab.classList.remove('active');
            scanButton.classList.remove('hidden');
        }

        function showFriendsView() {
            passportView.classList.add('hidden');
            passportView.classList.remove('flex');
            mapView.classList.add('hidden');
            mapView.classList.remove('flex');
            friendsView.classList.remove('hidden');
            friendsView.classList.add('flex');
            settingsView.classList.add('hidden');
            settingsView.classList.remove('flex');

            passportTab.classList.remove('active');
            mapTab.classList.remove('active');
            friendsTab.classList.add('active');
            settingsTab.classList.remove('active');
            scanButton.classList.remove('hidden');
        }

        function showSettingsView() {
            passportView.classList.add('hidden');
            passportView.classList.remove('flex');
            mapView.classList.add('hidden');
            mapView.classList.remove('flex');
            friendsView.classList.add('hidden');
            friendsView.classList.remove('flex');
            settingsView.classList.remove('hidden');
            settingsView.classList.add('flex');

            passportTab.classList.remove('active');
            mapTab.classList.remove('active');
            friendsTab.classList.remove('active');
            settingsTab.classList.add('active');
            // Hide the scan button on the settings page
            scanButton.classList.add('hidden');
        }
        

        // === Core Scanning and Verification Logic ===
        
        function startScan() {
            // Check if we already have this stamp
            if (document.getElementById(newStamp.id)) {
                // In a real app, use a custom modal
                console.log("Stamp already collected!");
                // We'll just briefly show a message
                const fab = scanButton.querySelector('i');
                fab.classList.remove('ph-scan');
                fab.classList.add('ph-check');
                setTimeout(() => {
                    fab.classList.remove('ph-check');
                    fab.classList.add('ph-scan');
                }, 1500);
                return;
            }

            // Switch to the scanning view (hides tabs and main content)
            passportView.classList.add('hidden');
            mapView.classList.add('hidden');
            friendsView.classList.add('hidden');
            settingsView.classList.add('hidden');
            scanningView.classList.remove('hidden');
            scanningView.classList.add('flex');
            
            // Hide tabs and FAB
            document.querySelector('.tab-bar').classList.add('hidden');
            scanButton.classList.add('hidden');
            
            // Start the simulated verification process
            runVerification();
        }

        function cancelScan() {
            // Switch back to the main view
            scanningView.classList.add('hidden');
            scanningView.classList.remove('flex');
            
            // Show the correct tab (default to passport) and FAB
            document.querySelector('.tab-bar').classList.remove('hidden');
            scanButton.classList.remove('hidden');
            showPassportView();


            // Clear any verification messages
            verificationSteps.innerHTML = '';
        }

        /**
         * Simulates the multi-step verification process
         */
        async function runVerification() {
            verificationSteps.innerHTML = '';
            
            try {
                await addStep('Connecting to VeraVisit Beacon...', 'ph-bluetooth-logo', 2000);
                await addStep('Requesting Galileo OS-NMA signature...', 'ph-satellite', 2000);
                await addStep('Signature received. Verifying...', 'ph-lock-key', 3000);
                await addStep('AUTHENTICATED! Location Verified.', 'ph-check-circle', 1000);
                grantNewStamp();

            } catch (err) {
                // This would catch errors if the promise was rejected
                console.error("Verification failed:", err);
                await addStep('Verification Failed!', 'ph-x-circle', 1000);
                setTimeout(cancelScan, 1500);
            }
        }

        /**
         * Helper function to show a delayed step in the UI
         */
        function addStep(message, icon, delay) {
            return new Promise((resolve, reject) => {
                // Add the new step message
                const step = document.createElement('div');
                step.className = 'flex items-center justify-center text-lg text-gray-300 mb-2 opacity-0 transition-opacity duration-500';
                step.innerHTML = `
                    <i class="ph ${icon} text-blue-300 mr-3 text-2xl"></i>
                    <span>${message}</span>
                `;
                
                // Remove 'in-progress' from previous step
                const lastStep = verificationSteps.querySelector('.in-progress');
                if (lastStep) {
                    lastStep.classList.remove('in-progress', 'text-gray-300');
                    lastStep.classList.add('text-green-400');
                }
                
                // Add new step
                verificationSteps.appendChild(step);
                // Force a repaint before adding class for transition to work
                void step.offsetWidth; 
                step.classList.add('opacity-100', 'in-progress');

                // Wait for the simulated delay, then resolve the promise
                setTimeout(resolve, delay);
            });
        }

        /**
         * Adds the new stamp to the UI and updates points
         */
        function grantNewStamp() {
            // 1. Create the new stamp HTML element
            const stampElement = document.createElement('div');
            stampElement.id = newStamp.id;
            stampElement.className = 'stamp-clickable aspect-square bg-white border-2 border-blue-500 rounded-lg p-3 flex flex-col items-center justify-center text-center shadow-lg cursor-pointer stamp-animation';
            
            // Add the data attributes so it can be clicked to open the modal
            stampElement.setAttribute('data-title', newStamp.name);
            stampElement.setAttribute('data-img', newStamp.img);
            stampElement.setAttribute('data-proof-text', newStamp.proof_text);

            stampElement.innerHTML = `
                <i class="ph-fill ph-check-circle text-green-500 text-2xl absolute top-2 right-2"></i>
                <i class="ph-bold ${newStamp.icon} text-5xl ${newStamp.color}"></i>
                <h3 class="font-semibold mt-2">${newStamp.name}</h3>
                <p class="text-xs text-gray-500">${newStamp.city}, ${newStamp.country}</p>
                <p class="text-xs text-gray-500">Verified: ${newStamp.date}</p>
            `;

            // 2. Add the new stamp to the grid
            stampGrid.appendChild(stampElement);
            
            // 3. Update points in the header
            const currentPoints = parseInt(userPointsEl.textContent);
            userPointsEl.textContent = currentPoints + 100; // Add 100 points
            
            // 4. Wait a moment, then switch back to the main view
            setTimeout(() => {
                cancelScan();
                // Scroll to the bottom to show the new stamp
                const screen = document.getElementById('app-screen');
                screen.scrollTop = screen.scrollHeight;
            }, 1000); // Wait 1 sec on the "AUTHENTICATED" message
        }

        /**
         * Opens the "Proof" modal
         */
        function openProofModal(stamp) {
            // Get data from the clicked stamp
            const title = stamp.getAttribute('data-title');
            const imgUrl = stamp.getAttribute('data-img');
            const proofText = stamp.getAttribute('data-proof-text');

            // Populate the modal
            modalTitle.textContent = title;

            if (proofText) {
                // We HAVE proof, show it
                modalImg.src = imgUrl;
                modalImg.classList.remove('hidden');
                modalCaption.textContent = proofText;
                modalCaptionWrapper.classList.remove('hidden');
                modalAddProof.classList.add('hidden');
            } else {
                // We DON'T have proof, show the "Add Proof" button
                modalImg.classList.add('hidden');
                modalCaptionWrapper.classList.add('hidden');
                modalAddProof.classList.remove('hidden');
            }
            
            // Show the modal
            proofModal.classList.remove('hidden');
        }

    </script>

</body>
</html>

